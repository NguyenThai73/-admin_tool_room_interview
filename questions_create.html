<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>面接テンプレート - People X</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#4338ca',
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            600: '#4338ca',
                            700: '#3730a3',
                            800: '#312e81',
                        },
                        sidebar: {
                            bg: '#2d1b69',
                            active: '#3730a3',
                        }
                    }
                }
            }
        }
        function getFilterOptions() {
            return {
                industries: ['IT・Web', '営業・販売', 'サービス・飲食', '事務・管理', 'クリエイティブ', 'マーケティング・広告', '物流・倉庫'],
                roles: ['フロントエンドエンジニア', 'バックエンドエンジニア', '営業', '接客', '事務', 'デザイナー', 'マーケティング', '軽作業'],
                hireTypes: ['新卒', '中途', 'アルバイト']
            };
        }
        function getCreateFixedData() {
            return {
                categoryBadges: [
                    { text: 'IT・Web', class: 'bg-primary-100 text-primary-800' },
                    { text: 'デザイン', class: 'bg-purple-100 text-purple-800' },
                    { text: '営業', class: 'bg-green-100 text-green-800' },
                    { text: 'マーケティング', class: 'bg-orange-100 text-orange-800' },
                    { text: '人事・総務', class: 'bg-blue-100 text-blue-800' }
                ],
                tags: ['技術', '基礎', 'ポテンシャル', '論理思考', 'デザイン思考', 'UX', '実務経験', '営業力', '対人スキル', '実績', 'コミュニケーション', 'PR', 'SNS', '事務', '対人', 'サポート']
            };
        }

        function populateCreateForm() {
            const { categoryBadges, tags } = getCreateFixedData();
            const { roles, hireTypes } = getFilterOptions();

            const categorySelect = document.getElementById('categoryBadge');
            const roleSelect = document.getElementById('role');
            const hireTypeSelect = document.getElementById('hireType');
            const tagsSelect = document.getElementById('tags');

            categoryBadges.forEach((c, i) => {
                const opt = document.createElement('option');
                opt.value = String(i);
                opt.textContent = c.text;
                opt.dataset.class = c.class;
                categorySelect.appendChild(opt);
            });

            roles.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                roleSelect.appendChild(opt);
            });

            hireTypes.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                hireTypeSelect.appendChild(opt);
            });

            tags.forEach(v => {
                const opt = document.createElement('option');
                opt.value = v;
                opt.textContent = v;
                tagsSelect.appendChild(opt);
            });
        }

        const state = {
            questions: []
        };

        function renderQuestions() {
            const list = document.getElementById('questionsList');
            list.innerHTML = state.questions.map((q, idx) => `
                <div class=\"flex items-center gap-3 bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded px-3 py-3\" draggable=\"true\" data-idx=\"${idx}\" ondragstart=\"onDragStart(event)\" ondragover=\"onDragOver(event)\" ondrop=\"onDrop(event)\">
                    <button class=\"text-gray-400 cursor-move p-1 rounded hover:bg-gray-200\" title=\"並び替え\" aria-label=\"並び替え\">
                        <svg class=\"w-5 h-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\">
                            <circle cx=\"5\" cy=\"5\" r=\"1.6\"></circle>
                            <circle cx=\"10\" cy=\"5\" r=\"1.6\"></circle>
                            <circle cx=\"15\" cy=\"5\" r=\"1.6\"></circle>
                            <circle cx=\"5\" cy=\"10\" r=\"1.6\"></circle>
                            <circle cx=\"10\" cy=\"10\" r=\"1.6\"></circle>
                            <circle cx=\"15\" cy=\"10\" r=\"1.6\"></circle>
                            <circle cx=\"5\" cy=\"15\" r=\"1.6\"></circle>
                            <circle cx=\"10\" cy=\"15\" r=\"1.6\"></circle>
                            <circle cx=\"15\" cy=\"15\" r=\"1.6\"></circle>
                        </svg>
                    </button>
                    <input value=\"${q.text || ''}\" data-idx=\"${idx}\" placeholder=\"質問内容を入力\" class=\"flex-1 bg-transparent px-2 py-1 focus:outline-none\" oninput=\"updateQuestion(event,'text')\" />
                    <div class=\"flex items-center gap-2\">
                        <select data-idx=\"${idx}\" class=\"px-2 py-1 bg-white border border-gray-300 rounded\" onchange=\"updateQuestion(event,'durationMinutes')\">${[1,2,3,4,5].map(m => `<option ${Number((q.durationMinutes ?? 1))===m?'selected':''} value=\\\"${m}\\\">${m}分</option>`).join('')}</select>
                        <button class=\"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-gray-300 text-gray-500 hover:bg-red-50 hover:text-red-600 hover:border-red-300 transition-colors\" title=\"削除\" aria-label=\"削除\" onclick=\"removeQuestion(${idx})\">
                            <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M1 7h22M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2\"/>\n+</svg>
                        </button>
                    </div>
                </div>
            `).join('');

            // Update totals
            const total = state.questions.reduce((sum, q) => sum + (q.durationMinutes || 1), 0);
            document.getElementById('totalDuration').textContent = `${total}分`;
            const percent = Math.min(100, Math.round((total / 25) * 100));
            document.getElementById('durationBar').style.width = `${percent}%`;
        }

        function addQuestion() {
            state.questions.push({ text: '', durationMinutes: 2, tag: getCreateFixedData().tags[0] });
            renderQuestions();
        }

        function removeQuestion(idx) {
            state.questions.splice(idx, 1);
            renderQuestions();
        }

        function updateQuestion(e, field) {
            console.log('updateQuestion', e, field);
            const idx = Number(e.target.getAttribute('data-idx'));
            if (field === 'durationMinutes') {
                state.questions[idx][field] = parseInt(e.target.value, 10) || 1;
                // Re-render to update total time and progress bar
                renderQuestions();
            } else {
                state.questions[idx][field] = e.target.value;
            }
        }

        // Drag and drop handlers
        let dragSourceIndex = null;
        function onDragStart(e) {
            dragSourceIndex = Number(e.currentTarget.getAttribute('data-idx'));
            e.dataTransfer.effectAllowed = 'move';
        }

        function onDragOver(e) {
            e.preventDefault(); // allow drop
            e.dataTransfer.dropEffect = 'move';
        }

        function onDrop(e) {
            e.preventDefault();
            const targetIndex = Number(e.currentTarget.getAttribute('data-idx'));
            if (dragSourceIndex === null || targetIndex === dragSourceIndex) return;

            const moved = state.questions.splice(dragSourceIndex, 1)[0];
            state.questions.splice(targetIndex, 0, moved);
            dragSourceIndex = null;
            renderQuestions();
        }

        document.addEventListener('DOMContentLoaded', function() {
            populateCreateForm();
            document.getElementById('addQuestionBtn').addEventListener('click', addQuestion);
        });
    </script>
</head>

<body class="bg-gray-50">
    <!-- Sidebar Container -->
    <div id="sidebar-container"></div>
    <script src="sidebar.js"></script>


    <!-- Main Content -->
    <main class="ml-60 min-h-screen">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-8 py-6 sticky top-0 z-30">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-semibold text-gray-900">面接テンプレート作成</h1>
            </div>
            <p class="text-sm text-gray-500 mt-1">新しい面接テンプレートを作成します</p>
        </header>
        
        <!-- Create Template Form -->
        <section class="p-8">
            <div class="bg-white border border-gray-200 rounded-lg p-6">
                <div class="grid grid-cols-2 gap-6">
                    <!-- Left column -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">カテゴリ</label>
                            <select id="categoryBadge" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary-600">
                                <option value="">選択してください</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">職種</label>
                            <select id="role" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary-600">
                                <option value="">選択してください</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">採用区分</label>
                            <select id="hireType" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary-600">
                                <option value="">選択してください</option>
                            </select>
                        </div>
                    </div>
                    <!-- Right column -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">タイトル</label>
                            <input id="title" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="例: 新卒フロントエンドエンジニア面接テンプレート">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">説明</label>
                            <textarea id="description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-600" placeholder="テンプレートの説明を入力"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">タグ（複数選択可）</label>
                            <select id="tags" multiple class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary-600 h-28">
                            </select>
                            <div class="text-xs text-gray-500 mt-1">Cmd/Ctrl + Click để chọn nhiều</div>
                        </div>
                    </div>
                </div>

                <!-- Questions Section -->
                <div class="mt-8">
                    <h2 class="text-base font-semibold text-gray-900">質問設定</h2>
                    <p class="text-sm text-gray-500 mt-1">応募者に質問を作成します</p>

                    <div class="mt-4 border rounded-lg">
                        <div class="flex items-center justify-between px-4 py-3 border-b bg-gray-50 rounded-t-lg">
                            <div>
                                <div class="text-sm font-medium text-gray-800">選択済みの質問</div>
                                <div class="text-xs text-gray-500">通過時間: <span id="perQuestionTime">-</span></div>
                            </div>
                            <button id="addQuestionBtn" class="inline-flex items-center gap-2 bg-white text-gray-700 border border-gray-300 hover:bg-gray-100 text-sm font-medium px-3 py-1.5 rounded">
                                質問を追加
                            </button>
                        </div>

                        <div class="px-4 py-3">
                            <div class="flex items-center justify-between text-xs text-gray-600 mb-2">
                                <span>合計時間: <span id="totalDuration">0分</span> / 25分</span>
                            </div>
                            <div class="w-full h-2 bg-gray-100 rounded">
                                <div id="durationBar" class="h-2 bg-primary-600 rounded" style="width: 0%"></div>
                            </div>
                        </div>

                        <div id="questionsList" class="px-4 pb-4 space-y-3">
                            <!-- items render here -->
                        </div>
                    </div>
                </div>

                <div class="mt-8 flex justify-end gap-3">
                    <a href="questions.html" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">キャンセル</a>
                    <button id="saveTemplateBtn" class="px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg">保存</button>
                </div>
            </div>
        </section>
        
    </main>
</body>

</html>